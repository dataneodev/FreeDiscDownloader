<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:FreeDiscDownloader"
             xmlns:ff="clr-namespace:FFImageLoading.Forms;assembly=FFImageLoading.Forms"
             xmlns:fftransformations="clr-namespace:FFImageLoading.Transformations;assembly=FFImageLoading.Transformations"
             xmlns:ViewModels="clr-namespace:FreeDiscDownloader.ViewModels"
             xmlns:Models="clr-namespace:FreeDiscDownloader.Models"
             x:Class="FreeDiscDownloader.SearchPage"
             Title="Wyszukaj"
             x:Name="SearchPageContent">
    <ContentPage.Resources>
        <ResourceDictionary>
            <Color x:Key="toggledOnColor">#404040</Color>
            <Color x:Key="toggledOffColor">#C0C0C0</Color>
            <Color x:Key="toggledOnTextColor">White</Color>
            <Color x:Key="toggledOffTextColor">Black</Color>
        </ResourceDictionary>
    </ContentPage.Resources>
    <Grid Padding="0" RowSpacing="0">
        <Grid.ColumnDefinitions>
            <ColumnDefinition/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <SearchBar x:Name="searchBar" 
                   SearchCommand="{Binding SearchtextChange}"
                   SearchCommandParameter="{Binding Path=Text, Source={x:Reference searchBar}}"
                   Text="{Binding SearchText, Mode=TwoWay}"
                   Grid.Column="0" 
                   Grid.Row="0" 
                   Placeholder="Wyszukaj text" 
                   Margin="2"/>

        <StackLayout Grid.Column="0"
                    Grid.Row="1"                     
                    Margin="5"
                    HorizontalOptions="FillAndExpand"
                    HeightRequest="40"
                    Orientation="Horizontal">
            <local:ToggleButton IsToggled="{Binding AllToggleState, Mode=TwoWay}"
                                x:Name="allBtn"
                                Text="Wszystko"
                                Image="all.png"
                                FontSize="Micro"
                                Command="{Binding ToggleButtonItemTypeSelect}"
                                CommandParameter="all">
               <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup Name="ToggleStates">
                        <VisualState Name="ToggledOff">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOffColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOffTextColor}" />
                            </VisualState.Setters>
                        </VisualState>

                        <VisualState Name="ToggledOn">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOnColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOnTextColor}" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
            </local:ToggleButton>

            <local:ToggleButton IsToggled="{Binding MovieToggleState, Mode=TwoWay}" 
                                x:Name="movieBtn"
                                Text="Filmy"
                                Image="movie.png"
                                FontSize="Micro"
                                Command="{Binding ToggleButtonItemTypeSelect}"
                                CommandParameter="{x:Reference movieBtn}">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup Name="ToggleStates">
                        <VisualState Name="ToggledOff">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOffColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOffTextColor}" />
                            </VisualState.Setters>
                        </VisualState>

                        <VisualState Name="ToggledOn">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOnColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOnTextColor}" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
            </local:ToggleButton>

            <local:ToggleButton IsToggled="{Binding MusicToggleState, Mode=TwoWay}" 
                                x:Name="musicBtn"
                                Text="Muzyka"
                                Image="music.png"
                                FontSize="Micro"
                                Command="{Binding ToggleButtonItemTypeSelect}"
                                CommandParameter="music">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup Name="ToggleStates">
                        <VisualState Name="ToggledOff">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOffColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOffTextColor}" />
                            </VisualState.Setters>
                        </VisualState>

                        <VisualState Name="ToggledOn">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOnColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOnTextColor}" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
            </local:ToggleButton>

            <local:ToggleButton IsToggled="{Binding PictureToggleState, Mode=TwoWay}" 
                                x:Name="pictureBtn"
                                Text="Zdjęcia"
                                Image="picture.png"
                                FontSize="Micro"
                                Command="{Binding ToggleButtonItemTypeSelect}"
                                CommandParameter="picture">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup Name="ToggleStates">
                        <VisualState Name="ToggledOff">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOffColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOffTextColor}" />
                            </VisualState.Setters>
                        </VisualState>

                        <VisualState Name="ToggledOn">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOnColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOnTextColor}" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
            </local:ToggleButton>

            <local:ToggleButton  IsToggled="{Binding OtherToggleState, Mode=TwoWay}" 
                                 x:Name="otherBtn"
                                 Text="Inne"
                                 Image="other.png"
                                 FontSize="Micro"
                                 Command="{Binding ToggleButtonItemTypeSelect}"
                                 CommandParameter="other">
                <VisualStateManager.VisualStateGroups>
                    <VisualStateGroup Name="ToggleStates">
                        <VisualState Name="ToggledOff">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOffColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOffTextColor}" />
                            </VisualState.Setters>
                        </VisualState>

                        <VisualState Name="ToggledOn">
                            <VisualState.Setters>
                                <Setter Property="BackgroundColor" Value="{StaticResource toggledOnColor}" />
                                <Setter Property="TextColor" Value="{StaticResource toggledOnTextColor}" />
                            </VisualState.Setters>
                        </VisualState>
                    </VisualStateGroup>
                </VisualStateManager.VisualStateGroups>
            </local:ToggleButton>
        </StackLayout>

        <ListView x:Name="listItem" 
                  ItemsSource="{Binding SearchItemList}"
                  Grid.Row="2" 
                  Grid.Column="0" 
                  Margin="5,0,5,0"  
                  HorizontalOptions="FillAndExpand" 
                  VerticalOptions="FillAndExpand"
                  HasUnevenRows="True"
                  >
            <ListView.ItemTemplate>
                <DataTemplate>
                    <ViewCell>
                        <Grid Padding="2" RowSpacing="0" ColumnSpacing="5" Margin="0,0,5,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition/>
                                <ColumnDefinition/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <ff:CachedImage x:Name="imageItem" 
                                            Grid.Column="0" 
                                            Grid.Row="0" 
                                            Grid.RowSpan="3" 
                                            DownsampleToViewSize="true" 
                                            RetryCount="3" 
                                            RetryDelay="1000"
                                            Aspect="AspectFit"
                                            HeightRequest="90"
                                            Source="{Binding ImageUrl}"/>
                            <Label Grid.Column="1"
                                   Grid.ColumnSpan="2" 
                                   Grid.Row="0" 
                                   Text="{Binding Title}" 
                                   FontAttributes="Bold" 
                                   FontSize="Medium"
                                   HeightRequest="50"/>
                            <Label Grid.Column="1" 
                                   Grid.Row="1" 
                                   Text="{Binding Size}" 
                                   FontSize="Small" 
                                   Margin="0"/>
                            <Label Grid.Column="1" 
                                   Grid.Row="2" 
                                   Text="{Binding Autor}" 
                                   FontSize="Small" 
                                   Margin="0"/>
                            <Label Grid.Column="2" 
                                   Grid.Row="1" 
                                   Text="{Binding TypeImage}" 
                                   FontSize="Small" 
                                   Margin="0" 
                                   HorizontalOptions="End"/>
                            <Label Grid.Column="2" 
                                   Grid.Row="2" 
                                   Text="{Binding Date}" 
                                   FontSize="Small" 
                                   Margin="0" 
                                   HorizontalOptions="End"/>
                        </Grid>
                    </ViewCell>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>
        <Label Grid.Row="3" Grid.Column="0" Text="{Binding FotterText}" Margin="5"/>
    </Grid>

</ContentPage>
